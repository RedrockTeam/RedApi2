#!/usr/bin/env node

var debug = require('debug')('RedApi2');
var fs = require('fs');
var path =  require('path');
var createConfig = require('./createConfig');

if(! fs.existsSync(path.join(process.cwd(), "config.json"))){
    createConfig(start);
}
else{
    start();
}

function start(){
    var app = require('../app');
    var http = require('http');
    var ioController = require('../common/io').io;

    app.set('port', process.env.PORT || 3000);

    var _server = require('http').Server(app);

    var server = _server.listen(app.get('port'), function() {
        debug('Express server listening on port ' + server.address().port);
    });

    var io = require('socket.io')(server, {path: "/admin"});
    ioController(io);

}

